<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’­æ”¾é€Ÿåº¦æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2196F3;
        }
        
        .speed-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .speed-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .speed-card.active {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        
        .speed-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }
        
        .speed-desc {
            font-size: 14px;
            color: #666;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #2196F3;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .test-btn:hover {
            background: #1976D2;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .speed-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .time-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .time-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 16px;
        }
        
        .time-label {
            color: #666;
            margin-right: 5px;
        }
        
        .time-value {
            font-weight: bold;
            color: #333;
        }
        
        .current-time {
            color: #2196F3 !important;
            font-size: 18px !important;
        }
        
        .progress-container {
            margin-bottom: 20px;
        }
        
        .progress-bar {
            position: relative;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #21CBF3);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .test-log {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-time {
            color: #666;
            margin-right: 10px;
        }
        
        .log-speed {
            color: #2196F3;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .log-message {
            color: #333;
        }
        
        .explanation {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .explanation h3 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        
        .explanation ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .explanation li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸš€ æ’­æ”¾é€Ÿåº¦æµ‹è¯•</h1>
            <p>æµ‹è¯•ä¸åŒæ’­æ”¾é€Ÿåº¦ä¸‹çš„è½¨è¿¹å›æ”¾æ•ˆæœ</p>
        </div>
        
        <!-- é€Ÿåº¦ä¿¡æ¯å¡ç‰‡ -->
        <div class="speed-info">
            <div class="speed-card" data-speed="0.5">
                <div class="speed-value">0.5x</div>
                <div class="speed-desc">æ…¢é€Ÿæ’­æ”¾</div>
            </div>
            <div class="speed-card active" data-speed="1">
                <div class="speed-value">1x</div>
                <div class="speed-desc">æ­£å¸¸é€Ÿåº¦</div>
            </div>
            <div class="speed-card" data-speed="2">
                <div class="speed-value">2x</div>
                <div class="speed-desc">å¿«é€Ÿæ’­æ”¾</div>
            </div>
            <div class="speed-card" data-speed="4">
                <div class="speed-value">4x</div>
                <div class="speed-desc">è¶…å¿«æ’­æ”¾</div>
            </div>
        </div>
        
        <!-- æ—¶é—´æ˜¾ç¤º -->
        <div class="time-display">
            <span class="time-item">
                <span class="time-label">å¼€å§‹:</span>
                <span class="time-value" id="start-time">--:--:--</span>
            </span>
            <span class="time-item">
                <span class="time-label">å½“å‰:</span>
                <span class="time-value current-time" id="current-time">--:--:--</span>
            </span>
            <span class="time-item">
                <span class="time-label">ç»“æŸ:</span>
                <span class="time-value" id="end-time">--:--:--</span>
            </span>
            <span class="time-item">
                <span class="time-label">é€Ÿåº¦:</span>
                <span class="time-value" id="current-speed">1x</span>
            </span>
        </div>
        
        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="test-controls">
            <button id="play-btn" class="test-btn">æ’­æ”¾</button>
            <button id="pause-btn" class="test-btn">æš‚åœ</button>
            <button id="reset-btn" class="test-btn">é‡ç½®</button>
            
            <select id="speed-select" class="speed-select">
                <option value="0.5">0.5x æ…¢é€Ÿ</option>
                <option value="1" selected>1x æ­£å¸¸</option>
                <option value="2">2x å¿«é€Ÿ</option>
                <option value="4">4x è¶…å¿«</option>
            </select>
            
            <button id="test-all-speeds" class="test-btn">æµ‹è¯•æ‰€æœ‰é€Ÿåº¦</button>
            <button id="clear-log" class="test-btn">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="test-log" id="test-log">
            <div class="log-entry">
                <span class="log-time">[ç­‰å¾…å¼€å§‹]</span>
                <span class="log-message">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹æµ‹è¯•...</span>
            </div>
        </div>
        
        <!-- è¯´æ˜ -->
        <div class="explanation">
            <h3>ğŸ”§ ä¿®å¤è¯´æ˜</h3>
            <p><strong>é—®é¢˜ï¼š</strong>åŸæ¥çš„ä»£ç ä¸­é€Ÿåº¦é€»è¾‘é¢ å€’äº†</p>
            <ul>
                <li><strong>é”™è¯¯é€»è¾‘ï¼š</strong> <code>100 / playSpeed</code> - 0.5å€é€Ÿæ—¶æ­¥é•¿å˜å¤§ï¼Œæ’­æ”¾æ›´å¿«</li>
                <li><strong>æ­£ç¡®é€»è¾‘ï¼š</strong> <code>100 * playSpeed</code> - 0.5å€é€Ÿæ—¶æ­¥é•¿å˜å°ï¼Œæ’­æ”¾æ›´æ…¢</li>
            </ul>
            <p><strong>æµ‹è¯•æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>é€‰æ‹©ä¸åŒé€Ÿåº¦ï¼Œè§‚å¯Ÿè½¨è¿¹æ’­æ”¾å¿«æ…¢</li>
                <li>0.5xåº”è¯¥æ¯”1xæ…¢ï¼Œ2xåº”è¯¥æ¯”1xå¿«</li>
                <li>æŸ¥çœ‹æ—¥å¿—ä¸­çš„æ—¶é—´æ­¥é•¿å˜åŒ–</li>
            </ul>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿè½¨è¿¹æ•°æ® -->
    <script>
        // ç”Ÿæˆæµ‹è¯•è½¨è¿¹æ•°æ®
        const generateTestTrajectory = () => {
            const startTime = new Date('2025/07/14 15:00:00');
            const data = [];
            
            for (let i = 0; i < 20; i++) {
                const time = new Date(startTime.getTime() + i * 5000); // æ¯5ç§’ä¸€ä¸ªç‚¹
                const coords = [
                    106.500692 + i * 0.0001, // ç»åº¦é€’å¢
                    29.615953 + i * 0.0001   // çº¬åº¦é€’å¢
                ];
                
                data.push({
                    time: time.toISOString().replace('T', ' ').substring(0, 19),
                    coords: coords
                });
            }
            
            return {
                id: 'test-trajectory',
                name: 'æµ‹è¯•è½¨è¿¹',
                color: '#FF5722',
                data: data
            };
        };

        // æ¨¡æ‹Ÿæ’­æ”¾å™¨ç±»ï¼ˆç®€åŒ–ç‰ˆï¼Œä»…ç”¨äºæµ‹è¯•é€Ÿåº¦é€»è¾‘ï¼‰
        class SpeedTestPlayer {
            constructor() {
                this.currentTime = null;
                this.startTime = null;
                this.endTime = null;
                this.playSpeed = 1;
                this.isPlaying = false;
                this.callbacks = {};
                
                this.loadTestData();
            }
            
            loadTestData() {
                const trajectory = generateTestTrajectory();
                this.startTime = new Date(trajectory.data[0].time);
                this.endTime = new Date(trajectory.data[trajectory.data.length - 1].time);
                this.currentTime = this.startTime;
                
                this.notifyTimeUpdate();
            }
            
            setCallbacks(callbacks) {
                this.callbacks = callbacks;
            }
            
            play() {
                if (this.isPlaying) return;
                this.isPlaying = true;
                this.startAnimation();
                this.notifyPlayStateChange();
            }
            
            pause() {
                this.isPlaying = false;
                this.notifyPlayStateChange();
            }
            
            reset() {
                this.isPlaying = false;
                this.currentTime = this.startTime;
                this.notifyTimeUpdate();
                this.notifyPlayStateChange();
            }
            
            setPlaySpeed(speed) {
                this.playSpeed = speed;
                this.logSpeed(`è®¾ç½®æ’­æ”¾é€Ÿåº¦ä¸º ${speed}x`);
            }
            
            startAnimation() {
                const animate = () => {
                    if (!this.isPlaying) return;
                    
                    // ä¿®å¤åçš„æ­£ç¡®é€»è¾‘
                    const timeStep = 100 * this.playSpeed;
                    const nextTime = new Date(this.currentTime.getTime() + timeStep);
                    
                    this.logSpeed(`æ—¶é—´æ­¥é•¿: ${timeStep}ms, ä» ${this.formatTime(this.currentTime)} åˆ° ${this.formatTime(nextTime)}`);
                    
                    if (nextTime >= this.endTime) {
                        this.currentTime = this.endTime;
                        this.isPlaying = false;
                        this.notifyTimeUpdate();
                        this.notifyPlayStateChange();
                        this.logSpeed('æ’­æ”¾ç»“æŸ');
                        return;
                    }
                    
                    this.currentTime = nextTime;
                    this.notifyTimeUpdate();
                    
                    setTimeout(animate, 100);
                };
                
                animate();
            }
            
            getProgress() {
                if (!this.startTime || !this.endTime) return 0;
                return (this.currentTime - this.startTime) / (this.endTime - this.startTime);
            }
            
            notifyTimeUpdate() {
                if (this.callbacks.onTimeUpdate) {
                    this.callbacks.onTimeUpdate({
                        currentTime: this.currentTime,
                        startTime: this.startTime,
                        endTime: this.endTime,
                        progress: this.getProgress()
                    });
                }
            }
            
            notifyPlayStateChange() {
                if (this.callbacks.onPlayStateChange) {
                    this.callbacks.onPlayStateChange({
                        isPlaying: this.isPlaying
                    });
                }
            }
            
            formatTime(date) {
                if (!date) return '--:--:--';
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                const seconds = date.getSeconds().toString().padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            }
            
            logSpeed(message) {
                const logElement = document.getElementById('test-log');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `
                    <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                    <span class="log-speed">${this.playSpeed}x</span>
                    <span class="log-message">${message}</span>
                `;
                logElement.appendChild(entry);
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            const player = new SpeedTestPlayer();
            
            // DOMå…ƒç´ 
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const resetBtn = document.getElementById('reset-btn');
            const speedSelect = document.getElementById('speed-select');
            const testAllBtn = document.getElementById('test-all-speeds');
            const clearLogBtn = document.getElementById('clear-log');
            
            const startTimeEl = document.getElementById('start-time');
            const currentTimeEl = document.getElementById('current-time');
            const endTimeEl = document.getElementById('end-time');
            const currentSpeedEl = document.getElementById('current-speed');
            const progressFill = document.getElementById('progress-fill');
            
            // è®¾ç½®å›è°ƒ
            player.setCallbacks({
                onTimeUpdate: (timeInfo) => {
                    startTimeEl.textContent = player.formatTime(timeInfo.startTime);
                    currentTimeEl.textContent = player.formatTime(timeInfo.currentTime);
                    endTimeEl.textContent = player.formatTime(timeInfo.endTime);
                    progressFill.style.width = `${timeInfo.progress * 100}%`;
                },
                onPlayStateChange: (state) => {
                    playBtn.disabled = state.isPlaying;
                    pauseBtn.disabled = !state.isPlaying;
                    playBtn.textContent = state.isPlaying ? 'æ’­æ”¾ä¸­...' : 'æ’­æ”¾';
                }
            });
            
            // äº‹ä»¶ç›‘å¬
            playBtn.addEventListener('click', () => player.play());
            pauseBtn.addEventListener('click', () => player.pause());
            resetBtn.addEventListener('click', () => player.reset());
            
            speedSelect.addEventListener('change', (e) => {
                const speed = parseFloat(e.target.value);
                player.setPlaySpeed(speed);
                currentSpeedEl.textContent = `${speed}x`;
                
                // æ›´æ–°é€Ÿåº¦å¡ç‰‡çŠ¶æ€
                document.querySelectorAll('.speed-card').forEach(card => {
                    card.classList.toggle('active', parseFloat(card.dataset.speed) === speed);
                });
            });
            
            // æµ‹è¯•æ‰€æœ‰é€Ÿåº¦
            testAllBtn.addEventListener('click', async () => {
                const speeds = [0.5, 1, 2, 4];
                testAllBtn.disabled = true;
                
                for (const speed of speeds) {
                    player.reset();
                    speedSelect.value = speed;
                    speedSelect.dispatchEvent(new Event('change'));
                    
                    player.logSpeed(`å¼€å§‹æµ‹è¯• ${speed}x é€Ÿåº¦`);
                    player.play();
                    
                    // æ’­æ”¾3ç§’
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    player.pause();
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                testAllBtn.disabled = false;
                player.logSpeed('æ‰€æœ‰é€Ÿåº¦æµ‹è¯•å®Œæˆ');
            });
            
            clearLogBtn.addEventListener('click', () => {
                document.getElementById('test-log').innerHTML = `
                    <div class="log-entry">
                        <span class="log-time">[æ—¥å¿—å·²æ¸…ç©º]</span>
                        <span class="log-message">å‡†å¤‡å¼€å§‹æ–°çš„æµ‹è¯•...</span>
                    </div>
                `;
            });
            
            // é€Ÿåº¦å¡ç‰‡ç‚¹å‡»
            document.querySelectorAll('.speed-card').forEach(card => {
                card.addEventListener('click', () => {
                    const speed = parseFloat(card.dataset.speed);
                    speedSelect.value = speed;
                    speedSelect.dispatchEvent(new Event('change'));
                });
            });
        });
    </script>
</body>
</html>
